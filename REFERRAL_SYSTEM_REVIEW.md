# ุชูุฑูุฑ ูุญุต ูุธุงู ุงููุฑูู (Referral System)

## ๐ ููุฎุต ุงููุญุต

ุชู ูุญุต ูุธุงู ุงููุฑูู ูุงูุฅุญุงูุฉ ุจุงููุงูู. ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ ูุน ุจุนุถ ุงูุชุญุณููุงุช ุงููุทููุจุฉ.

---

## โ ูุง ูุนูู ุจุดูู ุตุญูุญ

### 1. ุชูููุฏ ููุฏ ุงูุฅุญุงูุฉ
- โ ูู ูุณุชุฎุฏู ูุญุตู ุนูู ููุฏ ุฅุญุงูุฉ ูุฑูุฏ ุนูุฏ ุงูุชุณุฌูู
- โ ุงูููุฏ ุซุงุจุช ููุง ูุชุบูุฑ (`ATLASXXXXXX`)
- โ ูุชู ุงูุชุญูู ูู ุนุฏู ุงูุชูุฑุงุฑ ูุจู ุงูุญูุธ

### 2. ูุธุงู ุงูููุงูุขุช
- โ ูุธุงู 3 ูุณุชููุงุช (EMP-1: 7%, EMP-2: 2%, EMP-3: 1%)
- โ ูุชู ุญุณุงุจ ุงูููุงูุขุช ุชููุงุฆูุงู ุนูุฏ ุงูููุงููุฉ ุนูู ุงูุฅูุฏุงุน
- โ ุงูููุงูุขุช ุชูุถุงู ุฅูู `profitBuffer` ูููุณุชุฎุฏููู

### 3. ุตูุญุฉ ุงููุฑูู
- โ ุนุฑุถ ููุฏ ุงูุฅุญุงูุฉ
- โ ุนุฑุถ ุฑุงุจุท ุงูุฅุญุงูุฉ
- โ ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงููุฑูู (ุงููุณุชููุงุช 1ุ 2ุ 3)
- โ ุฌุฏูู ุงูููุงูุขุช

---

## โ๏ธ ุงููุดุงูู ุงูููุชุดูุฉ

### 1. ูุดููุฉ ูู `trpc-adapter.ts`
**ุงูููู**: `client/src/lib/trpc-adapter.ts`  
**ุงููุดููุฉ**: `referral.info` ู `referral.team` ูุง ููุจูุงู `userId` ูู input  
**ุงูุญู**: ุชู ุชุญุฏูุซ `Team.tsx` ูุชูุฑูุฑ `userId` ูู `useAuth()`

### 2. ูุดููุฉ ูู `server/routers/referral.ts`
**ุงูููู**: `server/routers/referral.ts` (ุฌุฏูุฏ)  
**ุงููุดููุฉ**: ุชู ุฅูุดุงุก router ุฌุฏูุฏ ููู ูุญุชุงุฌ ุฅูู ุฅุถุงูุชู ูู `appRouter`  
**ุงูุญู**: โ ุชู ุฅุถุงูุชู ูู `server/trpc/index.ts`

### 3. ูุดููุฉ ูู `Team.tsx`
**ุงูููู**: `client/src/pages/Team.tsx`  
**ุงููุดููุฉ**: ูุง ููุฑุฑ `userId` ุฅูู queries  
**ุงูุญู**: โ ุชู ุงูุชุญุฏูุซ ูุงุณุชุฎุฏุงู `useAuth()` ูุชูุฑูุฑ `userId`

---

## ๐ง ุงูุชุนุฏููุงุช ุงููููุฐุฉ

### 1. ุฅูุดุงุก `referralRouter` ูููุตู
**ุงูููู**: `server/routers/referral.ts` (ุฌุฏูุฏ)

**ุงูุฏูุงู**:
- `info`: ุฌูุจ ูุนูููุงุช ุงูุฅุญุงูุฉ (ุงูููุฏ ูุงูุฑุงุจุท)
- `team`: ุฌูุจ ุฅุญุตุงุฆูุงุช ุงููุฑูู (ุงููุณุชููุงุช 1ุ 2ุ 3)

### 2. ุฅุถุงูุฉ `referralRouter` ุฅูู `appRouter`
**ุงูููู**: `server/trpc/index.ts`
```typescript
export const appRouter = router({
  // ... existing routers
  referral: referralRouter,
});
```

### 3. ุชุญุฏูุซ `Team.tsx`
**ุงูููู**: `client/src/pages/Team.tsx`
- โ ุฅุถุงูุฉ `useAuth()` ููุญุตูู ุนูู `userId`
- โ ุชูุฑูุฑ `userId` ุฅูู queries
- โ ุฅุถุงูุฉ `enabled` option ููุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู

---

## ๐ ูููู ูุธุงู ุงููุฑูู

### ุงููุณุชููุงุช:
1. **ุงููุณุชูู 1 (EMP-1)**: ุงูุฅุญุงูุงุช ุงููุจุงุดุฑุฉ - 7%
2. **ุงููุณุชูู 2 (EMP-2)**: ุฅุญุงูุงุช ุงููุณุชูู ุงูุฃูู - 2%
3. **ุงููุณุชูู 3 (EMP-3)**: ุฅุญุงูุงุช ุงููุณุชูู ุงูุซุงูู - 1%

### ุณูุฑ ุงูุนูู:
```
ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ โ ูุณุชุฎุฏู ููุฏ ุฅุญุงูุฉ โ ูุชู ุญูุธ referredBy
โ
ุนูุฏ ุงูุฅูุฏุงุน โ ุงูุฃุฏูู ููุงูู โ ูุชู ุญุณุงุจ ุงูููุงูุขุช ุชููุงุฆูุงู
โ
ุงูููุงูุขุช ุชูุถุงู ุฅูู profitBuffer ูููุณุชุฎุฏููู ูู ุงููุณุชููุงุช 1ุ 2ุ 3
```

---

## ๐ฏ ุงูููุฒุงุช ุงูุญุงููุฉ

### ุตูุญุฉ ุงููุฑูู (`/team`):
1. **ููุฏ ุงูุฅุญุงูุฉ**: ุนุฑุถ ุงูููุฏ ุงููุฑูุฏ ูููุณุชุฎุฏู
2. **ุฑุงุจุท ุงูุฅุญุงูุฉ**: ุฑุงุจุท ูุงูู ูููุณุฎ
3. **ุฅุญุตุงุฆูุงุช ุงููุฑูู**:
   - ุนุฏุฏ ุงููุณุชุฎุฏููู ูู ุงููุณุชูู 1
   - ุนุฏุฏ ุงููุณุชุฎุฏููู ูู ุงููุณุชูู 2
   - ุนุฏุฏ ุงููุณุชุฎุฏููู ูู ุงููุณุชูู 3
   - ุฅุฌูุงูู ุงููุฑูู
4. **ุฌุฏูู ุงูููุงูุขุช**: ุนุฑุถ ุงูููุงูุขุช ููู ูุจูุบ

---

## ๐ก ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ

### 1. ุฅุถุงูุฉ ุชูุงุตูู ุฃูุซุฑ
- ุนุฑุถ ูุงุฆูุฉ ุจุฃุนุถุงุก ุงููุฑูู
- ุนุฑุถ ุงูููุงูุขุช ุงูููุชุณุจุฉ
- ุนุฑุถ ุชุงุฑูุฎ ุงูุฅุญุงูุงุช

### 2. ุชุญุณูู ุงูุฃุฏุงุก
- ุงุณุชุฎุฏุงู JOIN queries ุจุฏูุงู ูู loops
- ุฅุถุงูุฉ caching ููุงุณุชุนูุงูุงุช ุงููุชูุฑุฑุฉ

### 3. ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ
- ุฅุญุตุงุฆูุงุช ุงูููุงูุขุช ุงูุดูุฑูุฉ
- ุชุฑุชูุจ ุงููุณุชุฎุฏููู ุญุณุจ ุนุฏุฏ ุงูุฅุญุงูุงุช
- ุฅุดุนุงุฑุงุช ุนูุฏ ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ ูููุฑูู

---

## ๐ ุงูุฎูุงุตุฉ

**ุญุงูุฉ ุงููุธุงู**: โ **ูุนูู ุจุดูู ุฌูุฏ**

- โ ุชูููุฏ ููุฏ ุฅุญุงูุฉ ูุฑูุฏ ูุซุงุจุช
- โ ูุธุงู ุงูููุงูุขุช ูุนูู ุชููุงุฆูุงู
- โ ุตูุญุฉ ุงููุฑูู ุชุนุฑุถ ุงููุนูููุงุช ุจุดูู ุตุญูุญ
- โ ุญุณุงุจ ุงููุณุชููุงุช ูุนูู ุจุดูู ุตุญูุญ

**ุงููููุงุช ุงููุนุฏูุฉ**:
1. `server/routers/referral.ts` - ุฌุฏูุฏ
2. `server/trpc/index.ts` - ุฅุถุงูุฉ referralRouter
3. `client/src/pages/Team.tsx` - ุชุญุฏูุซ ูุชูุฑูุฑ userId

---

**ุชุงุฑูุฎ ุงููุญุต**: 2024  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
